node ('master'){
def server = Artifactory.server "jfrog"
def buildInfo = Artifactory.newBuildInfo()

stage('Git-CheckOut') {
  git 'https://github.com/jyotiprasad06/devopsproject.git'
}
stage('Maven-Clean') {
    sh 'mvn clean'
}

stage('Maven-Compile') {
sh 'mvn compile'
}

stage('Maven-Test') {
sh 'mvn test'
}

stage('Maven-Package') {
sh 'mvn package'
}

stage('SonarQube') {
  withSonarQubeEnv('Sonar') {
    sh 'mvn sonar:sonar'
  }
}
stage('Build Management') {
   def uploadSpec = """{ 
     "files": [
        {
         "pattern": "**/*.war",
         "target": "generic-local"
        }
      ]

}"""
server.upload spec: uploadSpec

}

stage('Download Package') {
   def downloadSpec = """{ 
     "files": [
       {
        "pattern": "generic-local/*.war",
         "target": "files/"
       }
      ]
   }"""
   server.download spec: downloadSpec
 }

stage('Deploying to stage server') {
 deploy adapters: [tomcat8(credentialsId: 'edd0013c-d2fc-4ceb-9acb-db1689b2cc1b', path: '', url: 'http://34.68.249.66:8081/')], contextPath: 'jsp-boot-tst', war: 'files/*.war'
}

}
